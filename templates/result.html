<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prediction Result</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='result.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

</head>
<body>
    <div class="container">
        <h1>Hey {{ name }}!</h1>
        <p class="email">{{ email }}</p>

        <h2>Details Entered by You:</h2>

        <button id="toggleDetailsBtn">Show Details</button>
<div id="detailsTable" style="display:none;">
     <table>
    {% set label_map = {
        "age": "Age",
        "sex": "Gender",
        "cp": "Chest Pain Type",
        "trestbps": "Resting Blood Pressure (mmHg)",
        "chol": "Cholesterol Level (mg/dL)",
        "fbs": "Fasting Blood Sugar > 120 mg/dL",
        "restecg": "Resting ECG Result",
        "heartRate": "Max Heart Rate Achieved",
        "exang": "Exercise Induced Angina",
        "oldpeak": "Oldpeak (ST Depression)",
        "BMI": "Body Mass Index (BMI)",
        "diaBP": "Diastolic Blood Pressure",
        "glucose": "Glucose Level (mg/dL)",
        "Smkr": "Smoker"
    } %}

    {% for key, value in user_data.items() %}
    <tr>
        <td>{{ label_map[key] if key in label_map else key }}</td>
        <td>{{ value }}</td>
    </tr>
    {% endfor %}
</table>
</div>
        
        {% if prediction is not none %}
        <div class="result">
            <h2>Prediction: <span class="{{ 'risk' if prediction == 1 else 'safe' }}">{{ 'At Risk' if prediction == 1 else 'Not At Risk' }}</span></h2>

            <button id="shareBtn">Share Your Result</button>
            <button id="downloadPdfBtn">Download Result as PDF</button>



            <!-- Graph Analysis -->
            <div class="analysis-section">
                <p class="risk-info">
                    {% if prediction == 1 %}
                        This indicates that you may be at a higher risk of heart failure. Consider consulting a medical professional and reviewing your lifestyle factors.
                    {% else %}
                        Great! You are not currently at risk based on the data provided. Maintain a healthy lifestyle to stay safe.
                    {% endif %}
                </p>
            </div>
        </div>
        {% endif %}
    </div>
    
    <script>

        //share button
document.getElementById('shareBtn').addEventListener('click', () => {
    const shareText = `Heart Failure Prediction Result for {{ name }}:\n` +
                      `Prediction: {{ 'At Risk' if prediction == 1 else 'Not At Risk' }}\n` +
                      `Please consult a medical professional if necessary.`;

    if (navigator.share) {
        navigator.share({
            title: 'Heart Failure Prediction Result',
            text: shareText,
        }).catch(console.error);
    } else {
        // fallback for browsers without native share API
        navigator.clipboard.writeText(shareText).then(() => {
            alert('Result copied to clipboard!');
        });
    }
});

//download

document.getElementById('downloadPdfBtn').addEventListener('click', () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.setFontSize(16);
    doc.text(`Heart Failure Prediction Result for {{ name }}`, 10, 20);

    const predictionText = `Prediction: {{ 'At Risk' if prediction == 1 else 'Not At Risk' }}`;
    doc.setFontSize(14);
    doc.text(predictionText, 10, 40);

    const details = `Details Entered:\n` + 
      `{% for key, value in user_data.items() %}` +
      `{{ label_map[key] if key in label_map else key }}: {{ value }}\n` +
      `{% endfor %}`;

    doc.setFontSize(12);
    doc.text(details, 10, 60);

    doc.save('HeartFailurePredictionResult.pdf');
});

//details
const toggleBtn = document.getElementById('toggleDetailsBtn');
const details = document.getElementById('detailsTable');

toggleBtn.addEventListener('click', () => {
    if (details.style.display === 'none') {
        details.style.display = 'block';
        toggleBtn.textContent = 'Hide Details';
    } else {
        details.style.display = 'none';
        toggleBtn.textContent = 'Show Details';
    }
});


</script>

</body>
</html>
